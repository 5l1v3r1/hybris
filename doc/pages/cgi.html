
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="it"
 lang="it" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<!-- metadata -->
<meta name="generator" content="Offline" />
<meta name="version" content="Offline 0.1" />
<!-- style sheet links -->
<link rel="stylesheet" media="all" type="text/css" href="../css/all.css" />
<link rel="stylesheet" media="screen" type="text/css" href="../css/screen.css" />
<link rel="stylesheet" media="print" type="text/css" href="../css/print.css" />

</head>
<body>
<div class="dokuwiki export">




<h1><a name="introduzione" id="introduzione">Introduzione</a></h1>
<div class="level1">

<p>

E&#039; possibile eseguire degli script Hybris in modalità <acronym title="Common Gateway Interface">CGI</acronym> all&#039;interno di un qualsiasi server web che supporti questa tecnologia, al fine di poter utilizzare le sue funzionalità per servire pagine dinamiche o effettuare elaborazioni complesse.
</p>

<p>
Per abilitare questa funzionalità, bisogna innanzitutto inserire nel file di configurazione del VirtualHost di Apache che ci interessa, la stringa :

</p>
<pre class="code">AllowOverride All
Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec +ExecCGI
AddHandler cgi-script hy</pre>

<p>

e riavviare il web server, in questo modo ogni file con estensione .hy verrà interpretato come script <acronym title="Common Gateway Interface">CGI</acronym>.
</p>

<p>
Fatto questo, va inserita la seguente riga all&#039;inizio dello script (o degli script) che voglia utilizzare come <acronym title="Common Gateway Interface">CGI</acronym>, per istruire il server su come eseguirli :
</p>
<pre class="code hybris">#<span class="sy0">!/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>hybris <span class="sy0">--</span>cgi</pre>

<p>
Ad esempio, il classico script “Hello World” in modalità <acronym title="Common Gateway Interface">CGI</acronym> sarebbe :
</p>
<pre class="code hybris">#<span class="sy0">!/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>hybris <span class="sy0">--</span>cgi
&nbsp;
<span class="kw2">import</span> std.<span class="sy0">*;</span>
&nbsp;
<span class="kw3">println</span><span class="br0">&#40;</span> <span class="st0">&quot;Content-Type: text/html<span class="es0">\n</span><span class="es0">\n</span>&quot;</span>.
         <span class="st0">&quot;&lt;b&gt;Hello World !&lt;/b&gt;&quot;</span> <span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>
<!-- SECTION "Introduzione" [1-1075] -->
<h1><a name="la_classe_cgi" id="la_classe_cgi">La classe CGI</a></h1>
<div class="level1">

<p>

Per semplificare le operazioni più comuni di quando si implementa un <acronym title="Common Gateway Interface">CGI</acronym> (parserizzazione dei dati in POST, dell&#039;<acronym title="Uniform Resource Locator">URL</acronym>, ecc), si può utilizzare la classe

</p>
<pre class="code">std.io.network.CGI</pre>

<p>
Lo scopo principale di questa classe è di far trovare all&#039;utente, nel momento in cui viene istanziata, tutte le variabili sia in GET che in POST già istanziate e correttamente parserizzate.
</p>

<p>
Ad esempio, se volessimo replicare l&#039;esempio di prima tramite questa classe :
</p>
<pre class="code hybris">#<span class="sy0">!/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>hybris <span class="sy0">--</span>cgi
&nbsp;
<span class="kw2">include</span> std.<span class="me1">io</span>.<span class="me1">network</span>.<span class="me1">CGI</span><span class="sy0">;</span>
&nbsp;
cgi <span class="sy0">=</span> <span class="kw2">new</span> CGI<span class="br0">&#40;</span> <span class="st0">&quot;text/html&quot;</span> <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
cgi <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;&lt;b&gt;Hello World !&lt;/b&gt;&quot;</span><span class="sy0">;</span></pre>

<p>
Oppure, per stampare le variabili in GET e POST :
</p>
<pre class="code hybris">#<span class="sy0">!/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>hybris <span class="sy0">--</span>cgi
&nbsp;
<span class="kw2">include</span> std.<span class="me1">io</span>.<span class="me1">network</span>.<span class="me1">CGI</span><span class="sy0">;</span>
&nbsp;
cgi <span class="sy0">=</span> <span class="kw2">new</span> CGI<span class="br0">&#40;</span> <span class="st0">&quot;text/html&quot;</span> <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// stampo le variabili GET</span>
<span class="kw1">foreach</span><span class="br0">&#40;</span> name <span class="sy0">-&gt;</span> value <span class="kw1">of</span> cgi<span class="sy0">-&gt;</span>GET <span class="br0">&#41;</span><span class="br0">&#123;</span>
    cgi <span class="sy0">&lt;&lt;</span> name <span class="sy0">&lt;&lt;</span> <span class="st0">&quot; = &quot;</span> <span class="sy0">&lt;&lt;</span> value <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;&lt;br&gt;&quot;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="co1">// stampo le variabili POST</span>
<span class="kw1">foreach</span><span class="br0">&#40;</span> name <span class="sy0">-&gt;</span> value <span class="kw1">of</span> cgi<span class="sy0">-&gt;</span>POST <span class="br0">&#41;</span><span class="br0">&#123;</span>
    cgi <span class="sy0">&lt;&lt;</span> name <span class="sy0">&lt;&lt;</span> <span class="st0">&quot; = &quot;</span> <span class="sy0">&lt;&lt;</span> value <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;&lt;br&gt;&quot;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
Gli attributi di questa classe, in realtà provengono da una mappa interna prelevata dalle variabili di ambiente che il server passa al <acronym title="Common Gateway Interface">CGI</acronym> durante lo startup, ed è possibile accedervi direttamente grazie all&#039;<a href="classe.html" class="wikilink1" title="classe">overloading del descrittore __attribute</a>.
</p>

</div>
<!-- SECTION "La classe CGI" [1076-2343] -->
<h1><a name="note_sull_utilizzo_della_memoria" id="note_sull_utilizzo_della_memoria">Note sull&#039;utilizzo della memoria</a></h1>
<div class="level1">

<p>

Se si deve eseguire un operazione potenzialmente lunga o che comunque richiede molte risorse in termini di memoria, è consigliato abbassare la soglia di <a href="gestione_della_memoria.html" class="wikilink1" title="gestione_della_memoria">garbage collection</a> nel prefisso dello script, ad esempio a 10K :
</p>
<pre class="code hybris">#<span class="sy0">!/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>hybris <span class="sy0">-</span>cg 10K
&nbsp;
<span class="kw2">include</span> std.<span class="me1">io</span>.<span class="me1">network</span>.<span class="me1">CGI</span><span class="sy0">;</span>
&nbsp;
cgi <span class="sy0">=</span> <span class="kw2">new</span> CGI<span class="br0">&#40;</span> <span class="st0">&quot;text/html&quot;</span> <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// stampo le variabili GET</span>
<span class="kw1">foreach</span><span class="br0">&#40;</span> name <span class="sy0">-&gt;</span> value <span class="kw1">of</span> cgi<span class="sy0">-&gt;</span>GET <span class="br0">&#41;</span><span class="br0">&#123;</span>
    cgi <span class="sy0">&lt;&lt;</span> name <span class="sy0">&lt;&lt;</span> <span class="st0">&quot; = &quot;</span> <span class="sy0">&lt;&lt;</span> value <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;&lt;br&gt;&quot;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="co1">// stampo le variabili POST</span>
<span class="kw1">foreach</span><span class="br0">&#40;</span> name <span class="sy0">-&gt;</span> value <span class="kw1">of</span> cgi<span class="sy0">-&gt;</span>POST <span class="br0">&#41;</span><span class="br0">&#123;</span>
    cgi <span class="sy0">&lt;&lt;</span> name <span class="sy0">&lt;&lt;</span> <span class="st0">&quot; = &quot;</span> <span class="sy0">&lt;&lt;</span> value <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;&lt;br&gt;&quot;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

</div>
<!-- SECTION "Note sull'utilizzo della memoria" [2344-2975] -->
<h1><a name="esempio_completo" id="esempio_completo">Esempio completo</a></h1>
<div class="level1">

<p>

Per finire, concludiamo con un esempio che renda un po più l&#039;idea delle potenzialità di questa funzionalità di Hybris.
L&#039;esempio mostrerà un form nel quale l&#039;utente dovrà inserire la quantità di numeri primi da generare, successivamente al POST del form, lo script genererà N numeri primi, dove N è il numero inserito dall&#039;utente e li stamperà insieme ad alcune statistiche sul tempo di esecuzione e sulla memoria richiesta.
</p>
<pre class="code hybris">#<span class="sy0">!/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>hybris <span class="sy0">-</span>cg 10K
&nbsp;
<span class="kw2">import</span>  std.<span class="sy0">*;</span>
<span class="kw2">include</span> std.<span class="me1">io</span>.<span class="me1">network</span>.<span class="me1">CGI</span><span class="sy0">;</span>
&nbsp;
cgi <span class="sy0">=</span> <span class="kw2">new</span> CGI<span class="br0">&#40;</span><span class="st0">&quot;text/html&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">if</span><span class="br0">&#40;</span> cgi<span class="sy0">-&gt;</span>POST <span class="br0">&#41;</span><span class="br0">&#123;</span>
	start  <span class="sy0">=</span> <span class="kw3">ticks</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	tofind <span class="sy0">=</span> <span class="kw3">toint</span><span class="br0">&#40;</span> cgi<span class="sy0">-&gt;</span>POST<span class="br0">&#91;</span><span class="st0">&quot;n&quot;</span><span class="br0">&#93;</span> <span class="br0">&#41;</span><span class="sy0">;</span>
	found  <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
	n      <span class="sy0">=</span> <span class="nu0">3</span><span class="sy0">;</span>
	primes <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="kw1">while</span><span class="br0">&#40;</span> found <span class="sy0">&lt;</span> tofind <span class="br0">&#41;</span><span class="br0">&#123;</span>
		loop  <span class="sy0">=</span> <span class="kw3">sqrt</span><span class="br0">&#40;</span>n<span class="br0">&#41;</span><span class="sy0">;</span>
		prime <span class="sy0">=</span> <span class="kw1">true</span><span class="sy0">;</span>
		<span class="kw1">for</span><span class="br0">&#40;</span> div <span class="sy0">=</span> <span class="nu0">2</span><span class="sy0">;</span> div <span class="sy0">&lt;=</span> loop<span class="sy0">;</span> div<span class="sy0">++</span> <span class="br0">&#41;</span><span class="br0">&#123;</span>
			<span class="kw1">if</span><span class="br0">&#40;</span> n <span class="sy0">%</span> div <span class="sy0">==</span> 0 <span class="br0">&#41;</span><span class="br0">&#123;</span>
				prime <span class="sy0">=</span> <span class="kw1">false</span><span class="sy0">;</span>
				<span class="kw1">break</span><span class="sy0">;</span>
			<span class="br0">&#125;</span>
		<span class="br0">&#125;</span>
&nbsp;
		<span class="kw1">if</span><span class="br0">&#40;</span> prime <span class="br0">&#41;</span><span class="br0">&#123;</span>
			found<span class="sy0">++;</span>
			primes<span class="br0">&#91;</span><span class="br0">&#93;</span> <span class="sy0">=</span> n<span class="sy0">;</span>
		<span class="br0">&#125;</span>
&nbsp;
		n<span class="sy0">++;</span>
	<span class="br0">&#125;</span>
&nbsp;
	cgi <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;
&lt;table width='40%' border='0'&gt;
	&lt;tr&gt;
		&lt;td width='40%'&gt;&lt;b&gt;Tempo elaborazione&lt;/b&gt;&lt;/td&gt;
		&lt;td&gt;&quot;</span> <span class="sy0">&lt;&lt;</span> <span class="br0">&#40;</span><span class="kw3">ticks</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">-</span> start<span class="br0">&#41;</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot; ms&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td&gt;&lt;b&gt;Oggetti allocati&lt;/b&gt;&lt;/td&gt;
		&lt;td&gt;&quot;</span> <span class="sy0">&lt;&lt;</span> <span class="kw3">gc_mm_items</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td&gt;&lt;b&gt;Memoria usata&lt;/b&gt;&lt;/td&gt;
		&lt;td&gt;&quot;</span> <span class="sy0">&lt;&lt;</span> <span class="kw3">gc_mm_usage</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">&lt;&lt;</span> <span class="st0">&quot; byte&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;
&lt;br&gt;
&lt;br&gt;
&quot;</span><span class="sy0">;</span>
&nbsp;
	cgi <span class="sy0">&lt;&lt;</span> join<span class="br0">&#40;</span> <span class="st0">&quot;, &quot;</span><span class="sy0">,</span> primes <span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
<span class="kw1">else</span><span class="br0">&#123;</span>
	cgi <span class="sy0">&lt;&lt;</span> <span class="st0">&quot;
		&lt;form method='POST' action='prime.hy'&gt;
		&lt;input type='text' name='n'/&gt;
		&lt;input type='submit' name='submit' value='Quanti numeri primi desideri generare?'/&gt;
		&lt;/form&gt;
	    &quot;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

</div>
<!-- SECTION "Esempio completo" [2976-] --></div><!-- closes <div class="dokuwiki export">-->