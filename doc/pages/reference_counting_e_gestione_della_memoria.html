
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="it"
 lang="it" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<!-- metadata -->
<meta name="generator" content="Offline" />
<meta name="version" content="Offline 0.1" />
<!-- style sheet links -->
<link rel="stylesheet" media="all" type="text/css" href="../css/all.css" />
<link rel="stylesheet" media="screen" type="text/css" href="../css/screen.css" />
<link rel="stylesheet" media="print" type="text/css" href="../css/print.css" />

</head>
<body>
<div class="dokuwiki export">


<p>
Ogni oggetto creato all&#039;interno di uno script in Hybris viene allocato dinamicamente, di conseguenza è facile immaginare che se non
fosse presente un meccanismo per ottimizzare la gestione della memoria si andrebbe incontro ad un consumo di risorse eccessivo ed inutile.
</p>

<p>
E&#039; per questo che Hybris integra un meccanismo di garbage collection, basato su un contatore di “riferimenti” che ogni oggetto ha all&#039;interno della struttura che lo descrive.
Quando un oggetto è referenziato, il contatore viene incrementato di un unità, mentre quando perde un riferimento lo stesso contatore viene decrementato.
Tale sistema è in grado quindi di determinare quando un oggetto è “out of scope”, cioè quando non è più necessario ai fini della corretta
esecuzione del programma, deallocando la memoria da lui occupata ed eventualmente, nel caso di variabili di tipo misto
(un array di array ad esempio), deallocando anche le risorse occupate dagli oggetti in esso contenuti e non più referenziati.
</p>

<p>
Il ciclo nel quale il garbage collector libererà gli oggetti per i quali il contatore di riferimenti è minore o uguale a zero, viene eseguito quando la memoria occupata dal programma è superiore ad una soglia.
Tale soglia di default è di 2048000 byte (circa 2MB), ma può essere impostata arbitrariamente dall&#039;utente operando sugli <a href="l_interprete.html" class="wikilink1" title="l_interprete">argomenti della linea di comando</a>.
</p>

<p>
Consideriamo alcune circostanze nelle quali potrebbe verificarsi una perdita di memoria, analizzando rispettivamente il comportamento di un programma in C/C++ (nel quale si verificherà un cosiddetto memory leak) e nel corrispettivo algoritmico di uno script in Hybris (nel quale invece il garbage collector si occuperà di risolvere questo problema al posto nostro). 
</p>

<p>
<strong>Dereferenziazione di un oggetto</strong>
</p>

<p>
Versione C/C++ :
</p>
<pre class="code c"><span class="kw4">char</span> <span class="sy0">*</span>p_1 <span class="sy0">=</span> new <span class="kw4">char</span><span class="br0">&#91;</span><span class="nu0">100</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="co1">// p_1 punta ad una zona di memoria di 100 byte</span>
 <span class="sy0">*</span>p_2 <span class="sy0">=</span> new <span class="kw4">char</span><span class="br0">&#91;</span>200<span class="br0">&#93;</span><span class="sy0">;</span> <span class="co1">// p_2 punta ad una zona di memoria di 200 byte</span>
&nbsp;
 <span class="coMULTI">/* !!! dereferenziazione !!!
 * p_1 ora punta alla stessa zona di p_2 e di conseguenza
 * la zona di memoria che prima puntava (quella da 100 byte)
 * non è più referenziata, perciò non c'è un modo per deallocarla.
 */</span>
 p_1 <span class="sy0">=</span> p_2<span class="sy0">;</span></pre>

<p>
Versione Hybris :
</p>
<pre class="code hybris">stringa_1 <span class="sy0">=</span> <span class="st0">&quot;ciao mondo&quot;</span><span class="sy0">;</span> <span class="co1">// stringa_1 contiene un oggetto grande 11 byte (10 + terminatore nullo)</span>
 stringa_2 <span class="sy0">=</span> <span class="st0">&quot;hello world&quot;</span><span class="sy0">;</span> <span class="co1">// stringa_2 contiene un oggetto grande 12 byte (11 + terminatore nullo)</span>
&nbsp;
 <span class="coMULTI">/* deferenziazione
 * stringa_1 ora contiene lo stesso valore di stringa_2,
 * ciònonostante il garbage collector, prima di dereferenziare 
 * il vecchio oggetto, lo avrà deallocato e successivamente
 * avrà effettuato l'impostazione del nuovo valore
 */</span>
 stringa_1 <span class="sy0">=</span> stringa_2<span class="sy0">;</span></pre>

<p>
<strong>Valori di ritorno non utilizzati</strong>
</p>

<p>
Versione C/C++ :
</p>
<pre class="code c"><span class="kw4">char</span> <span class="sy0">*</span> funzione<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
    <span class="co1">// questa funzione alloca 100 byte e ne restituisce un puntatore</span>
    <span class="kw1">return</span> new <span class="kw4">char</span><span class="br0">&#91;</span>100<span class="br0">&#93;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="coMULTI">/* la funzione viene richiamata senza associare il valore di ritorno
* ad alcun puntatore, pertanto i 100 byte che ha allocato non sono
* tracciabili ne deallocabili
*/</span>
funzione<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// ... altre operazioni ...</span></pre>

<p>
Versione Hybris :
</p>
<pre class="code hybris"><span class="kw2">function</span>  funzione<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
    <span class="co1">// questa funzione restituisce un oggetto grande 11 byte (10 + terminatore nullo)</span>
    <span class="kw1">return</span> <span class="st0">&quot;ciao mondo&quot;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="coMULTI">/* la funzione viene richiamata senza associare il valore di ritorno
* ad alcun oggetto, tuttavia il garbage collector se ne accorgerà
* e libererà contestualmente la memoria occupata
*/</span>
funzione<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// ... altre operazioni</span></pre>
</div><!-- closes <div class="dokuwiki export">-->